# Logstash 설정 파일 - 파일 검색용

input {
  # 파일 입력 (문서 디렉토리 모니터링)
  file {
    path => "/documents/**/*"
    start_position => "beginning"
    sincedb_path => "/usr/share/logstash/data/sincedb"
    codec => "plain"
  }
}

filter {
  # 파일 경로에서 메타데이터 추출
  if [path] {
    grok {
      match => { "path" => "%{GREEDYDATA:file_path}" }
    }
    
    # 파일 확장자 추출
    if [path] =~ /\.(pdf|doc|docx|txt|rtf)$/ {
      mutate {
        add_field => { "file_type" => "document" }
      }
    } else if [path] =~ /\.(jpg|jpeg|png|gif|bmp)$/ {
      mutate {
        add_field => { "file_type" => "image" }
      }
    } else if [path] =~ /\.(mp4|avi|mov|wmv)$/ {
      mutate {
        add_field => { "file_type" => "video" }
      }
    } else {
      mutate {
        add_field => { "file_type" => "other" }
      }
    }
  }
  
  # 파일명 추출
  if [path] {
    grok {
      match => { "path" => ".*/(?<file_name>[^/]+)$" }
    }
  }
}

output {
  # Elasticsearch에 데이터 전송
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "file_search"
    document_type => "file"
  }
  
  # 디버깅용 (옵션)
  stdout {
    codec => rubydebug
  }
}
